---
type Props = {
  name: string;
  title?: string;
  size?: number;
  class?: string;
};

const { name, title, size = 20 } = Astro.props;

if (!name || /\.\.|\//.test(name)) {
  throw new Error(`Icon: invalid name: ${name}`);
}

const icons = import.meta.glob('../../athena/brand/icons/vendor/heroicons/24/outline/*.svg', {
  eager: true,
  query: '?raw',
  import: 'default'
});

const key = `../../athena/brand/icons/vendor/heroicons/24/outline/${name}.svg`;
const raw = icons[key];
if (!raw) throw new Error(`Icon: not found: ${name}`);
let svg = String(raw);

// Normalize to use currentColor so the parent can style the icon.
svg = svg
  .replace(/\s(width|height)="[^"]*"/g, '')
  .replace(/\s(fill|stroke)="(?!none)[^"]*"/g, '');
---

<span
  class={['playbook-icon', Astro.props.class].filter(Boolean).join(' ')}
  style={`--playbook-icon-size:${size}px`}
  aria-hidden={title ? undefined : 'true'}
  role={title ? 'img' : undefined}
  aria-label={title}
  set:html={svg}
/>

<style>
  .playbook-icon{
    display: inline-flex;
    width: var(--playbook-icon-size);
    height: var(--playbook-icon-size);
    color: currentColor;
  }
  .playbook-icon :global(svg){
    width: 100%;
    height: 100%;
  }
  .playbook-icon :global(path),
  .playbook-icon :global(circle),
  .playbook-icon :global(rect),
  .playbook-icon :global(polyline),
  .playbook-icon :global(polygon),
  .playbook-icon :global(line){
    stroke: currentColor;
  }
</style>
