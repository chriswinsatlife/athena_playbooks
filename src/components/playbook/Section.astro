---
/**
 * Section - Main dispatcher component for playbook sections
 *
 * Renders a section with its content and embeds, dispatching to format-specific
 * renderers based on content.format.
 *
 * Playbooks are always for clients. The content itself describes what the client
 * does vs what they delegate to the EA.
 */

import SectionChecklist from './SectionChecklist.astro';
import SectionSteps from './SectionSteps.astro';
import SectionSpecs from './SectionSpecs.astro';
import SectionProse from './SectionProse.astro';
import EmbedRenderer from './EmbedRenderer.astro';

export interface ChecklistItem {
  label: string;
  details?: string;
  substeps?: string[];
}

export interface StepItem {
  label: string;
  details?: string;
}

export interface SpecItem {
  label: string;
  value: string;
}

export interface ProseContent {
  format: 'prose';
  text: string;
}

export interface ChecklistContent {
  format: 'checklist';
  items: ChecklistItem[];
}

export interface StepsContent {
  format: 'steps';
  items: StepItem[];
}

export interface SpecsContent {
  format: 'specs';
  items: SpecItem[];
}

export type SectionContent = ProseContent | ChecklistContent | StepsContent | SpecsContent;

export interface Callout {
  type: 'tip' | 'warning' | 'tool' | 'example' | 'quote';
  title?: string;
  content: string;
  tool_slug?: string;
}

export interface Embed {
  type: string;
  [key: string]: unknown;
}

export interface Props {
  id: string;
  title: string;
  icon?: string;
  content: SectionContent;
  embeds?: Embed[];
  callout?: Callout;
}

const { id, title, icon, content, embeds, callout } = Astro.props;

const calloutStyles: Record<string, { bg: string; border: string; icon: string }> = {
  tip: { bg: '#f0fdf4', border: '#5A8669', icon: 'üí°' },
  warning: { bg: '#fffbeb', border: '#d97706', icon: '‚ö†Ô∏è' },
  tool: { bg: '#eff6ff', border: '#3b82f6', icon: 'üîß' },
  example: { bg: '#faf5ff', border: '#9333ea', icon: 'üìù' },
  quote: { bg: '#f8fafc', border: '#64748b', icon: 'üí¨' },
};
---

<section id={id} class="playbook-section">
  <header class="section-header">
    <h2 class="section-title">
      {title}
    </h2>
  </header>

  <div class="section-content">
    {content.format === 'prose' && (
      <SectionProse text={content.text} />
    )}
    {content.format === 'checklist' && (
      <SectionChecklist items={content.items} />
    )}
    {content.format === 'steps' && (
      <SectionSteps items={content.items} />
    )}
    {content.format === 'specs' && (
      <SectionSpecs items={content.items} />
    )}
  </div>

  {callout && (
    <div 
      class="section-callout"
      style={`background: ${calloutStyles[callout.type]?.bg || '#f5f5f5'}; border-left-color: ${calloutStyles[callout.type]?.border || '#666'};`}
    >
      {callout.title && <p class="callout-title">{callout.title}</p>}
      <p class="callout-content">{callout.content}</p>
    </div>
  )}

  {embeds && embeds.length > 0 && (
    <div class="section-embeds">
      {embeds.map((embed) => (
        <EmbedRenderer embed={embed} />
      ))}
    </div>
  )}
</section>

<style>
  .playbook-section {
    font-family: 'Figtree', system-ui, -apple-system, sans-serif;
    padding: 2rem 0;
  }

  .playbook-section + .playbook-section {
    border-top: 1px solid #e5e5e5;
  }

  .section-header {
    margin-bottom: 1.25rem;
  }

  .section-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 1.5rem;
    font-weight: 400;
    color: #403422;
    margin: 0;
    line-height: 1.3;
  }

  .section-content {
    margin-bottom: 0;
  }

  .section-callout {
    margin-top: 1.5rem;
    padding: 1.25rem 1.5rem;
    border-left: 4px solid;
    border-radius: 0 0.5rem 0.5rem 0;
  }

  .callout-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: #403422;
    margin: 0 0 0.375rem 0;
  }

  .callout-content {
    font-size: 0.9375rem;
    color: #525252;
    line-height: 1.6;
    margin: 0;
  }

  .section-embeds {
    margin-top: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
</style>
