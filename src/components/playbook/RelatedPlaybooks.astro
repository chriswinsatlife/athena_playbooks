---
/**
 * RelatedPlaybooks - Display related playbook cards
 *
 * Takes an array of playbook slugs and renders them as linked cards.
 * Queries the playbook collection for titles and descriptions.
 *
 * Usage:
 *   <RelatedPlaybooks slugs={["personal-crm", "travel-automation"]} />
 */

import { getCollection } from 'astro:content';

export interface Props {
  slugs: string[];
  title?: string;
}

const { slugs, title = 'Related Playbooks' } = Astro.props;

// Fetch all playbooks and filter by slugs
const allPlaybooks = await getCollection('playbooks');
const relatedPlaybooks = slugs
  .map((slug) => allPlaybooks.find((p) => p.data.meta.slug === slug))
  .filter((p): p is NonNullable<typeof p> => p !== undefined);

// Get icon for area
function getAreaIcon(area: string): string {
  const icons: Record<string, string> = {
    relationships: '\u2764\uFE0F',
    'physical-health': '\u{1F3CB}',
    'mental-health': '\u{1F9D8}',
    'personal-finance': '\u{1F4B0}',
    'learning-pkm': '\u{1F4DA}',
    'passion-projects': '\u{1F3A8}',
    'bucket-list': '\u2705',
    'experiences-travel': '\u2708\uFE0F',
    admin: '\u{1F4CB}',
    finance: '\u{1F4C8}',
    people: '\u{1F465}',
    marketing: '\u{1F4E3}',
    sales: '\u{1F4BC}',
    product: '\u{1F4E6}',
    engineering: '\u{1F527}',
    operations: '\u2699\uFE0F',
    default: '\u{1F4D6}',
  };
  return icons[area] || icons.default;
}

// Format area for display
function formatArea(area: string): string {
  return area.replace(/-/g, ' ').replace(/\b\w/g, (c) => c.toUpperCase());
}
---

{relatedPlaybooks.length > 0 && (
  <section class="related-section">
    <h2 class="related-title">{title}</h2>

    <div class="related-grid">
      {relatedPlaybooks.map((playbook) => {
        const { meta, hero } = playbook.data;
        const icon = getAreaIcon(meta.area);

        return (
          <a href={`/playbooks/${meta.slug}`} class="related-card">
            <div class="related-card-header">
              <span class="related-area-icon">{icon}</span>
              <span class="related-area">{formatArea(meta.area)}</span>
            </div>

            <h3 class="related-card-title">{hero.headline}</h3>
            <p class="related-card-description">{meta.description}</p>

            {meta.time_savings && (
              <div class="related-card-meta">
                <span class="related-card-stat">
                  <span class="stat-icon">\u23F1\uFE0F</span>
                  Save {meta.time_savings}
                </span>
              </div>
            )}

            <span class="related-card-link">
              View Playbook
              <svg
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                class="link-arrow"
              >
                <path
                  d="M3 8h10M9 4l4 4-4 4"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
          </a>
        );
      })}
    </div>
  </section>
)}

<style>
  .related-section {
    --related-fg: #403422;
    --related-sage: #5A8669;
    --related-muted: #666;
    --related-border: #e5e5e5;
    --related-bg: #fafafa;

    margin-bottom: 2.5rem;
    padding-top: 2rem;
    border-top: 1px solid var(--related-border);
  }

  .related-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 1.75rem;
    font-weight: 400;
    color: var(--related-fg);
    margin: 0 0 1.25rem 0;
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.25rem;
  }

  .related-card {
    display: flex;
    flex-direction: column;
    background: #fff;
    border: 1px solid var(--related-border);
    border-radius: 0.75rem;
    padding: 1.5rem;
    text-decoration: none;
    color: inherit;
    transition:
      box-shadow 0.2s ease,
      border-color 0.2s ease;
  }

  .related-card:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    border-color: var(--related-sage);
  }

  .related-card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .related-area-icon {
    font-size: 1rem;
  }

  .related-area {
    font-family: 'Figtree', system-ui, sans-serif;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--related-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .related-card-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 1.25rem;
    font-weight: 400;
    color: var(--related-fg);
    margin: 0 0 0.5rem 0;
    line-height: 1.3;
  }

  .related-card-description {
    font-family: 'Figtree', system-ui, sans-serif;
    font-size: 0.9375rem;
    line-height: 1.5;
    color: var(--related-muted);
    margin: 0 0 1rem 0;
    flex: 1;
  }

  .related-card-meta {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .related-card-stat {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-family: 'Figtree', system-ui, sans-serif;
    font-size: 0.8125rem;
    color: var(--related-muted);
  }

  .stat-icon {
    font-size: 0.875rem;
  }

  .related-card-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    font-family: 'Figtree', system-ui, sans-serif;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--related-sage);
  }

  .link-arrow {
    transition: transform 0.2s ease;
  }

  .related-card:hover .link-arrow {
    transform: translateX(3px);
  }

  @media (max-width: 600px) {
    .related-grid {
      grid-template-columns: 1fr;
    }

    .related-card {
      padding: 1.25rem;
    }
  }
</style>
